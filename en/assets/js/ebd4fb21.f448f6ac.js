"use strict";(self.webpackChunkfuriku_docs=self.webpackChunkfuriku_docs||[]).push([[6293],{966:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"multitenancy","title":"\ud83c\udfe2 Arquitectura Multitenant","description":"Furiku fue dise\xf1ado desde el inicio para ser una plataforma SaaS multitenant, lo cual significa que m\xfaltiples negocios (tenants) pueden compartir la misma aplicaci\xf3n sin interferir entre s\xed.","source":"@site/docs/multitenancy.md","sourceDirName":".","slug":"/multitenancy","permalink":"/furiku-docs/en/docs/multitenancy","draft":false,"unlisted":false,"editUrl":"https://github.com/furiku/furiku-docs/edit/main/docs/multitenancy.md","tags":[],"version":"current","frontMatter":{"id":"multitenancy","title":"\ud83c\udfe2 Arquitectura Multitenant","sidebar_label":"Arquitectura Multitenant"},"sidebar":"tutorialSidebar","previous":{"title":"Arquitectura Backend","permalink":"/furiku-docs/en/docs/backend-architecture"},"next":{"title":"Autenticaci\xf3n y JWT","permalink":"/furiku-docs/en/docs/authentication-jwt"}}');var s=i(4848),r=i(8453);const t={id:"multitenancy",title:"\ud83c\udfe2 Arquitectura Multitenant",sidebar_label:"Arquitectura Multitenant"},l=void 0,d={},c=[{value:"\ud83e\udde0 \xbfQu\xe9 es multitenancy?",id:"-qu\xe9-es-multitenancy",level:2},{value:"\ud83e\uddf1 Estrategia de multitenancy aplicada",id:"-estrategia-de-multitenancy-aplicada",level:2},{value:"\ud83d\udd10 Validaciones contextuales",id:"-validaciones-contextuales",level:2},{value:"\ud83d\udd12 Reglas generales:",id:"-reglas-generales",level:3},{value:"\ud83d\udd0d \xbfD\xf3nde se valida el tenant?",id:"-d\xf3nde-se-valida-el-tenant",level:2},{value:"\ud83e\uddf0 Patr\xf3n de dise\xf1o aplicado",id:"-patr\xf3n-de-dise\xf1o-aplicado",level:2},{value:"\ud83e\uddea Ejemplo: Crear un producto",id:"-ejemplo-crear-un-producto",level:2},{value:"\ud83e\uddea Ejemplo: Acceso indebido",id:"-ejemplo-acceso-indebido",level:2},{value:"\ud83e\udde9 Ventajas del enfoque actual",id:"-ventajas-del-enfoque-actual",level:2},{value:"\u26a0\ufe0f Riesgos a mitigar",id:"\ufe0f-riesgos-a-mitigar",level:2},{value:"\ud83d\ude80 Evoluci\xf3n futura",id:"-evoluci\xf3n-futura",level:2},{value:"\u2705 Buenas pr\xe1cticas implementadas",id:"-buenas-pr\xe1cticas-implementadas",level:2},{value:"\ud83e\udde9 Conclusi\xf3n",id:"-conclusi\xf3n",level:2}];function o(e){const n={blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Furiku fue dise\xf1ado desde el inicio para ser una ",(0,s.jsx)(n.strong,{children:"plataforma SaaS multitenant"}),", lo cual significa que m\xfaltiples negocios (tenants) pueden compartir la misma aplicaci\xf3n sin interferir entre s\xed.",(0,s.jsx)(n.br,{}),"\n","Cada negocio tiene sus propios datos, usuarios, configuraciones y operaciones totalmente separadas del resto."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-qu\xe9-es-multitenancy",children:"\ud83e\udde0 \xbfQu\xe9 es multitenancy?"}),"\n",(0,s.jsxs)(n.p,{children:['Multitenancy es una arquitectura en la cual una sola instancia de la aplicaci\xf3n sirve a m\xfaltiples "clientes" (tenants), manteniendo ',(0,s.jsx)(n.strong,{children:"aislamiento l\xf3gico"})," entre ellos."]}),"\n",(0,s.jsx)(n.p,{children:"En Furiku, un tenant puede ser:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Una cafeter\xeda"}),"\n",(0,s.jsx)(n.li,{children:"Un restaurante"}),"\n",(0,s.jsx)(n.li,{children:"Una dark kitchen"}),"\n",(0,s.jsx)(n.li,{children:"Un food truck"}),"\n",(0,s.jsx)(n.li,{children:"Cualquier negocio independiente"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-estrategia-de-multitenancy-aplicada",children:"\ud83e\uddf1 Estrategia de multitenancy aplicada"}),"\n",(0,s.jsxs)(n.p,{children:["Furiku aplica multitenancy mediante ",(0,s.jsx)(n.strong,{children:"segregaci\xf3n l\xf3gica de datos"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Cada entidad relacionada al negocio (usuarios, productos, \xf3rdenes, facturas) contiene un campo:"}),"\n",(0,s.jsx)(n.p,{children:"tenantId: String"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Este campo representa el identificador \xfanico del negocio."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-validaciones-contextuales",children:"\ud83d\udd10 Validaciones contextuales"}),"\n",(0,s.jsxs)(n.p,{children:["El backend protege todos los recursos con validaciones estrictas de ",(0,s.jsx)(n.code,{children:"tenantId"}),".",(0,s.jsx)(n.br,{}),"\n","Se accede al tenant actual desde el JWT mediante el helper:"]}),"\n",(0,s.jsx)(n.p,{children:"currentUser.getTenantId();"}),"\n",(0,s.jsx)(n.h3,{id:"-reglas-generales",children:"\ud83d\udd12 Reglas generales:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Acci\xf3n"}),(0,s.jsx)(n.th,{children:"Requiere validaci\xf3n de tenant"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Consultar usuarios"}),(0,s.jsx)(n.td,{children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Crear productos"}),(0,s.jsx)(n.td,{children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Eliminar \xf3rdenes"}),(0,s.jsx)(n.td,{children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Consultar negocio"}),(0,s.jsx)(n.td,{children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Ver estad\xedsticas"}),(0,s.jsx)(n.td,{children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Eliminar otro negocio"}),(0,s.jsx)(n.td,{children:"\u274c Rechazado (solo OWNER del mismo tenant)"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-d\xf3nde-se-valida-el-tenant",children:"\ud83d\udd0d \xbfD\xf3nde se valida el tenant?"}),"\n",(0,s.jsxs)(n.p,{children:["En los ",(0,s.jsx)(n.strong,{children:"servicios"})," (no en los controladores) mediante comparaciones como:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"    if (!entity.getTenantId().equals(currentUser.getTenantId())) {\n        throw new WebApplicationException(...);\n    }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Y tambi\xe9n mediante filtrados en los repositorios:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'    find("tenantId = ?1 and deleted = false", tenantId)\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-patr\xf3n-de-dise\xf1o-aplicado",children:"\ud83e\uddf0 Patr\xf3n de dise\xf1o aplicado"}),"\n",(0,s.jsx)(n.p,{children:"La multitenancy est\xe1 integrada en:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["El modelo (",(0,s.jsx)(n.code,{children:"tenantId"})," como campo obligatorio)"]}),"\n",(0,s.jsx)(n.li,{children:"El repositorio (consultas filtradas)"}),"\n",(0,s.jsx)(n.li,{children:"El token (JWT contiene el tenant del usuario)"}),"\n",(0,s.jsx)(n.li,{children:"El servicio (validaciones de acceso cruzado)"}),"\n",(0,s.jsxs)(n.li,{children:["La auditor\xeda (cada acci\xf3n registra ",(0,s.jsx)(n.code,{children:"performedTenant"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-ejemplo-crear-un-producto",children:"\ud83e\uddea Ejemplo: Crear un producto"}),"\n",(0,s.jsxs)(n.p,{children:["Un ",(0,s.jsx)(n.code,{children:"MANAGER"}),' de "cafe-del-mar" intenta crear un producto.']}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"El token JWT contiene:"}),"\n",(0,s.jsx)(n.p,{children:'"tenantId": "cafe-del-mar"'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Al guardar el producto, el sistema fuerza:"}),"\n",(0,s.jsx)(n.p,{children:"product.setTenantId(currentUser.getTenantId());"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Nadie de otro tenant podr\xe1 ver o editar ese producto."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-ejemplo-acceso-indebido",children:"\ud83e\uddea Ejemplo: Acceso indebido"}),"\n",(0,s.jsxs)(n.p,{children:["Un ",(0,s.jsx)(n.code,{children:"OWNER"}),' de "taco-place" intenta acceder a usuarios de "cafe-del-mar":']}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Aunque tenga rol ",(0,s.jsx)(n.code,{children:"OWNER"}),", el sistema compara ",(0,s.jsx)(n.code,{children:"currentUser.getTenantId()"})," con el ",(0,s.jsx)(n.code,{children:"tenantId"})," del recurso solicitado."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Si no coinciden, se lanza:"}),"\n",(0,s.jsx)(n.p,{children:"HTTP 403 Forbidden \u2014 Access denied to resource in another tenant."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-ventajas-del-enfoque-actual",children:"\ud83e\udde9 Ventajas del enfoque actual"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Ventaja"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\ud83d\udd10 Seguridad"}),(0,s.jsx)(n.td,{children:"Aislamiento total por tenant"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u267b\ufe0f Escalabilidad"}),(0,s.jsx)(n.td,{children:"Agregar m\xe1s tenants no afecta a otros"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\ud83d\udce6 Simplicidad"}),(0,s.jsx)(n.td,{children:"Una sola base de datos y una sola app"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\ud83d\udd0d Auditor\xeda clara"}),(0,s.jsx)(n.td,{children:"Cada acci\xf3n incluye tenant de origen"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-riesgos-a-mitigar",children:"\u26a0\ufe0f Riesgos a mitigar"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Nunca confiar solo en el frontend para enviar ",(0,s.jsx)(n.code,{children:"tenantId"})]}),"\n",(0,s.jsx)(n.li,{children:"Siempre tomar el tenant desde el token JWT"}),"\n",(0,s.jsx)(n.li,{children:"No permitir b\xfasquedas globales sin validaci\xf3n"}),"\n",(0,s.jsx)(n.li,{children:"Evitar relaciones entre entidades de distintos tenants"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-evoluci\xf3n-futura",children:"\ud83d\ude80 Evoluci\xf3n futura"}),"\n",(0,s.jsxs)(n.p,{children:["Aunque hoy Furiku usa ",(0,s.jsx)(n.strong,{children:"segregaci\xf3n l\xf3gica en una misma base de datos"}),", est\xe1 listo para migrar a:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Bases de datos separadas por tenant"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Schemas por tenant"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Microservicios con aislaci\xf3n completa"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Esto permitir\xeda a\xfan mayor independencia y control de escalabilidad."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-buenas-pr\xe1cticas-implementadas",children:"\u2705 Buenas pr\xe1cticas implementadas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Cada entidad importante incluye ",(0,s.jsx)(n.code,{children:"tenantId"})]}),"\n",(0,s.jsxs)(n.li,{children:["Todo acceso pasa por ",(0,s.jsx)(n.code,{children:"CurrentUser"})]}),"\n",(0,s.jsxs)(n.li,{children:["Solo ",(0,s.jsx)(n.code,{children:"OWNER"})," puede eliminar o modificar el negocio"]}),"\n",(0,s.jsxs)(n.li,{children:["Las queries usan ",(0,s.jsx)(n.code,{children:"findByIdActive(tenantId)"})," o filtros seguros"]}),"\n",(0,s.jsx)(n.li,{children:"Las respuestas y errores est\xe1n internacionalizadas"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-conclusi\xf3n",children:"\ud83e\udde9 Conclusi\xf3n"}),"\n",(0,s.jsxs)(n.p,{children:["La arquitectura multitenant de Furiku permite ofrecer un SaaS profesional donde m\xfaltiples negocios operan sin interferencias.",(0,s.jsx)(n.br,{}),"\n","Es segura, limpia y extensible hacia soluciones m\xe1s avanzadas si el sistema crece."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\ud83c\udfe2 Un tenant es una frontera l\xf3gica. En Furiku, esa frontera es inquebrantable."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var a=i(6540);const s={},r=a.createContext(s);function t(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);
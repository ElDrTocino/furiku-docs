"use strict";(self.webpackChunkfuriku_docs=self.webpackChunkfuriku_docs||[]).push([[8526],{1645:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>t,metadata:()=>d,toc:()=>c});const d=JSON.parse('{"id":"soft-delete-audit","title":"\ud83e\uddfe Auditor\xeda y Soft Delete","description":"Furiku implementa una estrategia s\xf3lida de trazabilidad basada en una entidad abstracta AuditableEntity que proporciona control total sobre las acciones del sistema.","source":"@site/docs/soft-delete-audit.md","sourceDirName":".","slug":"/soft-delete-audit","permalink":"/furiku-docs/en/docs/soft-delete-audit","draft":false,"unlisted":false,"editUrl":"https://github.com/furiku/furiku-docs/edit/main/docs/soft-delete-audit.md","tags":[],"version":"current","frontMatter":{"id":"soft-delete-audit","title":"\ud83e\uddfe Auditor\xeda y Soft Delete","sidebar_label":"Auditor\xeda y Soft Delete"},"sidebar":"tutorialSidebar","previous":{"title":"M\xf3dulo de Negocios","permalink":"/furiku-docs/en/docs/business-module"},"next":{"title":"DTOs y API REST","permalink":"/furiku-docs/en/docs/dto-and-rest"}}');var n=s(4848),l=s(8453);const t={id:"soft-delete-audit",title:"\ud83e\uddfe Auditor\xeda y Soft Delete",sidebar_label:"Auditor\xeda y Soft Delete"},r=void 0,a={},c=[{value:"\ud83e\udde0 \xbfQu\xe9 incluye <code>AuditableEntity</code>?",id:"-qu\xe9-incluye-auditableentity",level:2},{value:"\ud83d\udd10 \xbfQu\xe9 es Soft Delete?",id:"-qu\xe9-es-soft-delete",level:2},{value:"\ud83d\udce6 \xbfD\xf3nde se usa?",id:"-d\xf3nde-se-usa",level:2},{value:"\ud83d\udee0 \xbfC\xf3mo se usa?",id:"-c\xf3mo-se-usa",level:2},{value:"1. Hereda de <code>AuditableEntity</code>",id:"1-hereda-de-auditableentity",level:3},{value:"2. Usa el repositorio base",id:"2-usa-el-repositorio-base",level:3},{value:"3. Aplica auditor\xeda al crear/editar",id:"3-aplica-auditor\xeda-al-creareditar",level:3},{value:"4. Elimina con trazabilidad (soft delete)",id:"4-elimina-con-trazabilidad-soft-delete",level:3},{value:"\ud83e\uddea M\xe9todos disponibles en <code>SoftDeletableRepository</code>",id:"-m\xe9todos-disponibles-en-softdeletablerepository",level:2},{value:"\ud83d\udea8 Buenas pr\xe1cticas",id:"-buenas-pr\xe1cticas",level:2},{value:"\u2705 Beneficios",id:"-beneficios",level:2},{value:"\ud83e\udde9 Extensiones futuras",id:"-extensiones-futuras",level:2}];function o(e){const i={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.p,{children:["Furiku implementa una estrategia s\xf3lida de trazabilidad basada en una entidad abstracta ",(0,n.jsx)(i.code,{children:"AuditableEntity"})," que proporciona control total sobre las acciones del sistema."]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsxs)(i.h2,{id:"-qu\xe9-incluye-auditableentity",children:["\ud83e\udde0 \xbfQu\xe9 incluye ",(0,n.jsx)(i.code,{children:"AuditableEntity"}),"?"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"@Embedded AuditMetadata"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"performedBy"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"performedRole"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"performedTenant"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"performedAt"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:"Timestamps autom\xe1ticos:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"createdAt"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"updatedAt"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["Soporte para ",(0,n.jsx)(i.strong,{children:"soft delete"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"isDeleted"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"deletedAt"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"deletedBy"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Todas las entidades cr\xedticas del sistema heredan de esta clase base para garantizar trazabilidad y limpieza de datos."}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-qu\xe9-es-soft-delete",children:"\ud83d\udd10 \xbfQu\xe9 es Soft Delete?"}),"\n",(0,n.jsx)(i.p,{children:"Soft delete es una estrategia en la que una entidad no se elimina f\xedsicamente de la base de datos, sino que se marca como eliminada mediante los campos mencionados anteriormente."}),"\n",(0,n.jsx)(i.p,{children:"Esto permite:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Recuperar datos si es necesario"}),"\n",(0,n.jsx)(i.li,{children:"Mantener integridad hist\xf3rica y auditor\xeda completa"}),"\n",(0,n.jsxs)(i.li,{children:["Filtrar f\xe1cilmente solo los registros \u201cactivos\u201d (",(0,n.jsx)(i.code,{children:"isDeleted = false"}),")"]}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-d\xf3nde-se-usa",children:"\ud83d\udce6 \xbfD\xf3nde se usa?"}),"\n",(0,n.jsx)(i.p,{children:"Actualmente, se implementa en:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"User"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"Business"})}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Y est\xe1 dise\xf1ado para expandirse a:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"Order"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"Product"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"Invoice"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"InventoryChange"})}),"\n",(0,n.jsx)(i.li,{children:"etc."}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-c\xf3mo-se-usa",children:"\ud83d\udee0 \xbfC\xf3mo se usa?"}),"\n",(0,n.jsxs)(i.h3,{id:"1-hereda-de-auditableentity",children:["1. Hereda de ",(0,n.jsx)(i.code,{children:"AuditableEntity"})]}),"\n",(0,n.jsx)(i.p,{children:"public class User extends AuditableEntity "}),"\n",(0,n.jsx)(i.p,{children:"Esto asegura que la entidad tenga todos los campos necesarios sin repetir c\xf3digo."}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h3,{id:"2-usa-el-repositorio-base",children:"2. Usa el repositorio base"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"    public class UserRepository implements SoftDeletableRepository<User, Long> {\n        // ya puedes usar findActive(), findByIdActive(), existsByFieldActive(), softDeleteById()\n    }\n"})}),"\n",(0,n.jsxs)(i.p,{children:["Esto elimina la necesidad de repetir ",(0,n.jsx)(i.code,{children:"deleted = false"})," en cada query."]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h3,{id:"3-aplica-auditor\xeda-al-creareditar",children:"3. Aplica auditor\xeda al crear/editar"}),"\n",(0,n.jsxs)(i.p,{children:["Utiliza ",(0,n.jsx)(i.code,{children:"AuditHelper"})," para registrar autom\xe1ticamente qui\xe9n realiz\xf3 la acci\xf3n, en qu\xe9 tenant y en qu\xe9 momento:"]}),"\n",(0,n.jsx)(i.p,{children:"user.setAudit(auditHelper.generate());"}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h3,{id:"4-elimina-con-trazabilidad-soft-delete",children:"4. Elimina con trazabilidad (soft delete)"}),"\n",(0,n.jsx)(i.p,{children:"userRepository.softDeleteById(userId, currentUser.getEmail());"}),"\n",(0,n.jsx)(i.p,{children:"Esto marcar\xe1:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"isDeleted = true"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"deletedAt = Instant.now()"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"deletedBy = currentUser.getEmail()"})}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Y la entidad ser\xe1 excluida de consultas est\xe1ndar autom\xe1ticamente."}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsxs)(i.h2,{id:"-m\xe9todos-disponibles-en-softdeletablerepository",children:["\ud83e\uddea M\xe9todos disponibles en ",(0,n.jsx)(i.code,{children:"SoftDeletableRepository"})]}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"M\xe9todo"}),(0,n.jsx)(i.th,{children:"Descripci\xf3n"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"findActive()"})}),(0,n.jsx)(i.td,{children:"Devuelve todos los registros activos"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"findByIdActive(ID)"})}),(0,n.jsx)(i.td,{children:"Busca por ID solo si no est\xe1 eliminado"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:'findByFieldActive("email", value)'})}),(0,n.jsx)(i.td,{children:"Consulta por campo filtrando los eliminados"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:'existsByFieldActive("email", value)'})}),(0,n.jsx)(i.td,{children:"Verifica existencia excluyendo eliminados"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"softDeleteById(ID, deletedBy)"})}),(0,n.jsx)(i.td,{children:"Marca como eliminado con auditor\xeda"})]})]})]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-buenas-pr\xe1cticas",children:"\ud83d\udea8 Buenas pr\xe1cticas"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Siempre usa ",(0,n.jsx)(i.code,{children:"findActive()"})," o ",(0,n.jsx)(i.code,{children:"findByIdActive()"})," en servicios"]}),"\n",(0,n.jsx)(i.li,{children:"No muestres datos eliminados a usuarios normales"}),"\n",(0,n.jsxs)(i.li,{children:["Solo ",(0,n.jsx)(i.code,{children:"OWNER"})," puede eliminar registros sensibles"]}),"\n",(0,n.jsxs)(i.li,{children:["Usa ",(0,n.jsx)(i.code,{children:"auditHelper.generate()"})," en cada creaci\xf3n o actualizaci\xf3n"]}),"\n",(0,n.jsx)(i.li,{children:"No permitas edici\xf3n de registros eliminados"}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-beneficios",children:"\u2705 Beneficios"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Ventaja"}),(0,n.jsx)(i.th,{children:"Descripci\xf3n"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\ud83d\udd10 Seguridad"}),(0,n.jsx)(i.td,{children:"Nunca pierdes informaci\xf3n cr\xedtica"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\ud83d\udd01 Reversibilidad"}),(0,n.jsx)(i.td,{children:"Puedes restaurar si es necesario"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\ud83d\udcca M\xe9tricas limpias"}),(0,n.jsx)(i.td,{children:"Puedes excluir eliminados en reportes"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\ud83e\udde0 Escalable"}),(0,n.jsx)(i.td,{children:"Se aplica f\xe1cilmente a cualquier entidad del sistema"})]})]})]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-extensiones-futuras",children:"\ud83e\udde9 Extensiones futuras"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Filtros autom\xe1ticos globales en Panache"}),"\n",(0,n.jsx)(i.li,{children:"Historial completo con Hibernate Envers"}),"\n",(0,n.jsx)(i.li,{children:"Vista de auditor\xeda por entidad en el panel de administraci\xf3n"}),"\n"]}),"\n",(0,n.jsxs)(i.blockquote,{children:["\n",(0,n.jsx)(i.p,{children:"\u2728 Esta estrategia asegura que Furiku sea escalable, auditable y profesional desde su n\xfacleo."}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},8453:(e,i,s)=>{s.d(i,{R:()=>t,x:()=>r});var d=s(6540);const n={},l=d.createContext(n);function t(e){const i=d.useContext(l);return d.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),d.createElement(l.Provider,{value:i},e.children)}}}]);
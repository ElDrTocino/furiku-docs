"use strict";(self.webpackChunkfuriku_docs=self.webpackChunkfuriku_docs||[]).push([[8427],{7107:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"authentication-jwt","title":"\ud83d\udd10 Autenticaci\xf3n y JWT","description":"Furiku utiliza JSON Web Tokens (JWT) como mecanismo principal de autenticaci\xf3n y autorizaci\xf3n entre m\xf3dulos, garantizando seguridad, escalabilidad y compatibilidad total con su arquitectura multitenant.","source":"@site/docs/authentication-jwt.md","sourceDirName":".","slug":"/authentication-jwt","permalink":"/furiku-docs/docs/authentication-jwt","draft":false,"unlisted":false,"editUrl":"https://github.com/furiku/furiku-docs/edit/main/docs/authentication-jwt.md","tags":[],"version":"current","frontMatter":{"id":"authentication-jwt","title":"\ud83d\udd10 Autenticaci\xf3n y JWT","sidebar_label":"Autenticaci\xf3n y JWT"},"sidebar":"tutorialSidebar","previous":{"title":"Arquitectura Multitenant","permalink":"/furiku-docs/docs/multitenancy"},"next":{"title":"M\xf3dulo de Usuarios","permalink":"/furiku-docs/docs/user-module"}}');var r=i(4848),a=i(8453);const t={id:"authentication-jwt",title:"\ud83d\udd10 Autenticaci\xf3n y JWT",sidebar_label:"Autenticaci\xf3n y JWT"},c=void 0,d={},l=[{value:"\ud83d\udd04 \xbfC\xf3mo funciona el flujo de autenticaci\xf3n?",id:"-c\xf3mo-funciona-el-flujo-de-autenticaci\xf3n",level:2},{value:"\ud83d\udee0 Estructura del JWT en Furiku",id:"-estructura-del-jwt-en-furiku",level:2},{value:"\ud83d\udd10 \xbfC\xf3mo se protege un endpoint?",id:"-c\xf3mo-se-protege-un-endpoint",level:2},{value:"\ud83e\udde0 \xbfC\xf3mo se obtiene el usuario actual?",id:"-c\xf3mo-se-obtiene-el-usuario-actual",level:2},{value:"\ud83e\uddea Ejemplo de inicio de sesi\xf3n",id:"-ejemplo-de-inicio-de-sesi\xf3n",level:2},{value:"\ud83d\udce5 \xbfC\xf3mo enviar el token desde el frontend?",id:"-c\xf3mo-enviar-el-token-desde-el-frontend",level:2},{value:"\ud83d\udea8 Validaciones importantes",id:"-validaciones-importantes",level:2},{value:"\u2705 Buenas pr\xe1cticas",id:"-buenas-pr\xe1cticas",level:2},{value:"\ud83d\udd27 Configuraci\xf3n base en <code>application.properties</code>",id:"-configuraci\xf3n-base-en-applicationproperties",level:2},{value:"\ud83e\udde9 Conclusi\xf3n",id:"-conclusi\xf3n",level:2}];function o(e){const n={blockquote:"blockquote",br:"br",code:"code",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Furiku utiliza JSON Web Tokens (JWT) como mecanismo principal de autenticaci\xf3n y autorizaci\xf3n entre m\xf3dulos, garantizando seguridad, escalabilidad y compatibilidad total con su arquitectura multitenant."}),"\n",(0,r.jsxs)(n.p,{children:["La implementaci\xf3n est\xe1 basada en ",(0,r.jsx)(n.code,{children:"quarkus-security"})," y no requiere un ",(0,r.jsx)(n.code,{children:"JwtProvider"})," personalizado, manteniendo el c\xf3digo limpio y desacoplado."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-c\xf3mo-funciona-el-flujo-de-autenticaci\xf3n",children:"\ud83d\udd04 \xbfC\xf3mo funciona el flujo de autenticaci\xf3n?"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Un usuario se registra o inicia sesi\xf3n"}),"\n",(0,r.jsx)(n.li,{children:"Si las credenciales son v\xe1lidas, el backend genera un token JWT"}),"\n",(0,r.jsx)(n.li,{children:"El token es enviado al cliente en la respuesta"}),"\n",(0,r.jsx)(n.li,{children:"El cliente lo incluye en todas las peticiones siguientes en el header:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"        Authorization: Bearer <jwt-token>\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsx)(n.li,{children:"El backend valida y extrae el contenido del token en cada endpoint protegido"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-estructura-del-jwt-en-furiku",children:"\ud83d\udee0 Estructura del JWT en Furiku"}),"\n",(0,r.jsx)(n.p,{children:"El token JWT contiene:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"sub"})}),(0,r.jsx)(n.td,{children:"Email del usuario"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"role"})}),(0,r.jsxs)(n.td,{children:["Rol del usuario (",(0,r.jsx)(n.code,{children:"OWNER"}),", ",(0,r.jsx)(n.code,{children:"MANAGER"}),", etc.)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"tenantId"})}),(0,r.jsx)(n.td,{children:"Negocio al que pertenece el usuario"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"iat"})}),(0,r.jsx)(n.td,{children:"Tiempo de emisi\xf3n"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"exp"})}),(0,r.jsx)(n.td,{children:"Tiempo de expiraci\xf3n (por defecto: 24h)"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo decodificado:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    {\n      "sub": "ana@cafe.com",\n      "role": "MANAGER",\n      "tenantId": "cafe-del-sol",\n      "iat": 1711200000,\n      "exp": 1711286400\n    }\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-c\xf3mo-se-protege-un-endpoint",children:"\ud83d\udd10 \xbfC\xf3mo se protege un endpoint?"}),"\n",(0,r.jsxs)(n.p,{children:["Furiku utiliza ",(0,r.jsx)(n.code,{children:"@RolesAllowed(...)"})," para restringir acciones:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\n    @GET\n    @Path("/api/users")\n    @RolesAllowed({"OWNER", "MANAGER"})\n    public List<User> getUsers() { ... }\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Tambi\xe9n puede validarse el tenant con ",(0,r.jsx)(n.code,{children:"CurrentUser.getTenantId()"})," para evitar accesos cruzados entre negocios."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-c\xf3mo-se-obtiene-el-usuario-actual",children:"\ud83e\udde0 \xbfC\xf3mo se obtiene el usuario actual?"}),"\n",(0,r.jsxs)(n.p,{children:["A trav\xe9s del helper ",(0,r.jsx)(n.code,{children:"CurrentUser"}),", que se apoya en ",(0,r.jsx)(n.code,{children:"SecurityIdentity"})," de Quarkus:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\n    currentUser.getEmail();\n    currentUser.getRole();\n    currentUser.getTenantId();\n"})}),"\n",(0,r.jsx)(n.p,{children:"Esto permite usar los datos del token sin tener que volver a consultar la base de datos."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-ejemplo-de-inicio-de-sesi\xf3n",children:"\ud83e\uddea Ejemplo de inicio de sesi\xf3n"}),"\n",(0,r.jsx)(n.p,{children:"POST /api/users/login"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'\n    {\n        "email": "ana@cafe.com",\n        "password": "miClave123"\n    }\n'})}),"\n",(0,r.jsx)(n.p,{children:"Respuesta exitosa:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'    {\n      "name": "Ana G\xf3mez",\n      "email": "ana@cafe.com",\n      "role": "MANAGER",\n      "token": "<jwt-token>"\n    }\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-c\xf3mo-enviar-el-token-desde-el-frontend",children:"\ud83d\udce5 \xbfC\xf3mo enviar el token desde el frontend?"}),"\n",(0,r.jsx)(n.p,{children:"En todas las peticiones protegidas:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\n    Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Ejemplo usando ",(0,r.jsx)(n.code,{children:"fetch"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\n    fetch("/api/products", {\n      method: "GET",\n      headers: {\n        "Authorization": "Bearer " + token\n      }\n    });\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-validaciones-importantes",children:"\ud83d\udea8 Validaciones importantes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Validaci\xf3n"}),(0,r.jsx)(n.th,{children:"Comportamiento"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Token ausente o malformado"}),(0,r.jsx)(n.td,{children:"\u274c 401 Unauthorized"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["Rol insuficiente (",(0,r.jsx)(n.code,{children:"@RolesAllowed"}),")"]}),(0,r.jsx)(n.td,{children:"\u274c 403 Forbidden"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Acceso a otro tenant"}),(0,r.jsx)(n.td,{children:"\u274c 403 Forbidden"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["Usuario eliminado (",(0,r.jsx)(n.code,{children:"isDeleted"}),")"]}),(0,r.jsx)(n.td,{children:"\u274c 403 Forbidden (en login)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Expiraci\xf3n del token"}),(0,r.jsx)(n.td,{children:"\u274c 401 Unauthorized"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-buenas-pr\xe1cticas",children:"\u2705 Buenas pr\xe1cticas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Nunca guardar el token en ",(0,r.jsx)(n.code,{children:"localStorage"})," (usa ",(0,r.jsx)(n.code,{children:"HttpOnly Cookie"})," o ",(0,r.jsx)(n.code,{children:"sessionStorage"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["El backend debe validar el ",(0,r.jsx)(n.code,{children:"tenantId"})," con el recurso solicitado"]}),"\n",(0,r.jsx)(n.li,{children:"Evita almacenar datos sensibles dentro del token"}),"\n",(0,r.jsx)(n.li,{children:"Regenera el token tras un cambio de rol o negocio"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"-configuraci\xf3n-base-en-applicationproperties",children:["\ud83d\udd27 Configuraci\xf3n base en ",(0,r.jsx)(n.code,{children:"application.properties"})]}),"\n",(0,r.jsx)(n.p,{children:"quarkus.jwt.enabled=true\nmp.jwt.verify.publickey.location=META-INF/resources/publicKey.pem\nquarkus.http.auth.permission.authenticated.paths=/api/*\nquarkus.http.auth.permission.authenticated.policy=authenticated"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Puedes usar ",(0,r.jsx)(n.code,{children:"RS256"})," con un par de llaves generadas con OpenSSL, o ",(0,r.jsx)(n.code,{children:"HS256"})," si prefieres clave secreta."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-conclusi\xf3n",children:"\ud83e\udde9 Conclusi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Furiku implementa JWT de forma limpia, usando ",(0,r.jsx)(n.code,{children:"quarkus-security"}),", sin providers personalizados ni l\xf3gica innecesaria.",(0,r.jsx)(n.br,{}),"\n","Esto permite:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Rutas protegidas por rol"}),"\n",(0,r.jsx)(n.li,{children:"Contexto de usuario accesible en cualquier parte del backend"}),"\n",(0,r.jsx)(n.li,{children:"Alto rendimiento y bajo acoplamiento"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\ud83d\udd10 JWT es el coraz\xf3n del control de acceso de Furiku. Toda acci\xf3n parte de una identidad verificada."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(6540);const r={},a=s.createContext(r);function t(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);